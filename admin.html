<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุตูุญุฉ ุงูุฅุฏุงุฑุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-6">
        <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
            <div class="text-center mb-8">
                <svg class="w-20 h-20 mx-auto text-red-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <h2 class="text-3xl font-bold text-gray-800">ุชุณุฌูู ุฏุฎูู ุงูุฅุฏุงุฑุฉ</h2>
                <p class="text-gray-600 mt-2">ูููุฏูุฑูู ููุท</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</label>
                    <input type="email" id="adminEmail" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-600 focus:outline-none text-lg" placeholder="admin@example.com">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ูููุฉ ุงูุณุฑ:</label>
                    <input type="password" id="adminPassword" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-red-600 focus:outline-none text-lg" placeholder="โขโขโขโขโขโขโขโข">
                </div>
                
                <button onclick="adminLogin()" class="w-full bg-red-600 text-white py-3 rounded-lg text-xl font-bold hover:bg-red-700 transition-colors">ุฏุฎูู</button>
                
                <a href="index.html" class="block text-center text-gray-600 hover:text-gray-800 mt-4">ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-red-600 to-red-800 text-white p-6 rounded-lg shadow-lg mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold">ุตูุญุฉ ุงูุฅุฏุงุฑุฉ</h1>
                    <p class="mt-2">ุฅุฏุงุฑุฉ ุงููุธุงู ูุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ</p>
                </div>
                <button onclick="adminLogout()" class="bg-white text-red-600 px-6 py-2 rounded-lg font-bold hover:bg-gray-100">ุฎุฑูุฌ</button>
            </div>
        </div>

        <!-- Center Name -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ุงุณู ุงููุฑูุฒ</h2>
            <div class="flex gap-4">
                <input type="text" id="centerName" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg" placeholder="ุงุณู ุงููุฑูุฒ ุงูุทุจู">
                <button onclick="saveCenterName()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ</button>
            </div>
        </div>

        <!-- News Ticker -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุดุฑูุท ุงูุฅุฎุจุงุฑู</h2>
            <div class="space-y-4">
                <input type="text" id="newsContent" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ูุญุชูู ุงูุดุฑูุท ุงูุฅุฎุจุงุฑู">
                <div class="flex gap-4 items-center">
                    <label class="text-gray-700">ุณุฑุนุฉ ุงูุชุญุฑู:</label>
                    <input type="number" id="newsSpeed" class="px-4 py-2 border border-gray-300 rounded-lg w-32" value="50" min="10" max="200">
                    <span class="text-gray-600">ุจูุณู/ุซุงููุฉ</span>
                    <button onclick="saveNews()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 mr-auto">ุญูุธ</button>
                </div>
            </div>
        </div>

        <!-- Alert Duration -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ูุฏุฉ ุนุฑุถ ุงูุชูุจูู</h2>
            <div class="flex gap-4 items-center">
                <input type="number" id="alertDuration" class="px-4 py-2 border border-gray-300 rounded-lg w-32" value="5" min="1" max="60">
                <span class="text-gray-600">ุซุงููุฉ</span>
                <button onclick="saveAlertDuration()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ</button>
            </div>
        </div>

        <!-- Auto-Cleanup Settings -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุชูุธูู ุงูุชููุงุฆู ููุจูุงูุงุช</h2>
            <div class="space-y-4">
                <div class="flex items-center gap-4">
                    <input type="checkbox" id="autoCleanup" class="w-5 h-5">
                    <label for="autoCleanup" class="text-gray-700 font-bold">ุชูุนูู ุงูุชูุธูู ุงูุชููุงุฆู ุงููููู</label>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-700 mb-2">ุนูุฏ ุงูุชูุนููุ ุณูุชู ุชููุงุฆูุงู ูู ููุชุตู ุงูููู:</p>
                    <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                        <li>ุญุฐู ุงููุฏุงุกุงุช ุงูุฃูุฏู ูู 24 ุณุงุนุฉ</li>
                        <li>ุญุฐู ุงูุชูุจููุงุช ุงูุฃูุฏู ูู 24 ุณุงุนุฉ</li>
                        <li>ุงูุงุญุชูุงุธ ุจุงูุนูุงุฏุงุช ูุงูุฃุทุจุงุก ูุงูุฅุนุฏุงุฏุงุช</li>
                    </ul>
                </div>
                <button onclick="saveAutoCleanup()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
            </div>
        </div>

        <!-- Audio & Video Settings -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุนุฏุงุฏุงุช ุงูุตูุช ูุงูููุฏูู</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 mb-2">ูุณุงุฑ ูููุงุช ุงูุตูุช:</label>
                    <input type="text" id="audioPath" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="audio/">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ูุณุงุฑ ูููุงุช ุงูููุฏูู:</label>
                    <input type="text" id="videoPath" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="media/">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ูุงุฆูุฉ ุงูููุฏูููุงุช (ูู ููุฏูู ูู ุณุทุฑ):</label>
                    <textarea id="videoList" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg font-mono" placeholder="video1.mp4&#10;video2.mp4&#10;video3.mp4"></textarea>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุงุณุชุฎุฏุงู ูุณุงุฑ ุฏุงุฎูู (Android TV):</label>
                    <input type="checkbox" id="useLocalVideos" class="mr-2">
                    <label for="useLocalVideos" class="text-sm text-gray-600">ุชูุนูู ุงููุตูู ูููููุงุช ุงููุญููุฉ</label>
                    <input type="text" id="localVideoPath" class="w-full px-4 py-2 border border-gray-300 rounded-lg mt-2" placeholder="/sdcard/Videos/">
                    <p class="text-xs text-gray-500 mt-1">ูุซุงู: /sdcard/Videos/ ุฃู /storage/emulated/0/Videos/</p>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="saveMediaSettings()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
            </div>
            <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-500 p-4">
                <p class="text-sm text-gray-700"><strong>ููุงุญุธุฉ:</strong> ูุงุณุชุฎุฏุงู ุงููููุงุช ุงููุญููุฉ ุนูู Android TVุ ุชุฃูุฏ ูู ููุญ ุงูุชุทุจูู ุตูุงุญูุงุช ุงููุตูู ููุชุฎุฒูู.</p>
            </div>
        </div>

        <!-- Clinics Management -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">ุฅุฏุงุฑุฉ ุงูุนูุงุฏุงุช</h2>
                <button onclick="showAddClinic()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">ุฅุถุงูุฉ ุนูุงุฏุฉ ุฌุฏูุฏุฉ</button>
            </div>
            <div id="clinicsList" class="space-y-3"></div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-gray-700 mb-2">ูุฏุงุก ุนููู ูู ุนูุงุฏุฉ:</label>
                    <select id="callClinicSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2"></select>
                    <input type="number" id="callNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2" placeholder="ุฑูู ุงูุนููู">
                    <button onclick="callCustomer()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 w-full">ูุฏุงุก</button>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุชูุจูู ุนูู ุงูุดุงุดุฉ:</label>
                    <input type="text" id="alertMessage" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2" placeholder="ุฑุณุงูุฉ ุงูุชูุจูู">
                    <button onclick="sendAlert()" class="bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700 w-full">ุฅุฑุณุงู ุชูุจูู</button>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุชูุจูู ูุตูุญุงุช ุงูุชุญูู:</label>
                    <select id="controlAlertClinic" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2"></select>
                    <input type="text" id="controlAlertMessage" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2" placeholder="ุฑุณุงูุฉ ุงูุชูุจูู">
                    <button onclick="sendControlAlert()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 w-full">ุฅุฑุณุงู</button>
                </div>
            </div>
            <div class="mt-4">
                <button onclick="resetAllClinics()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">ุชุตููุฑ ุฌููุน ุงูุนูุงุฏุงุช</button>
            </div>
        </div>

        <!-- Audio Controls -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุชุญูู ุจุงูุตูุช</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-gray-700 mb-2">ุฅุฐุงุนุฉ ููู ุฌุงูุฒ:</label>
                    <select id="instantAudio" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2">
                        <option value="">ุงุฎุชุฑ ููู</option>
                        <option value="instant1.mp3">instant1.mp3</option>
                        <option value="instant2.mp3">instant2.mp3</option>
                        <option value="instant3.mp3">instant3.mp3</option>
                    </select>
                    <button onclick="playInstant()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 w-full">ุชุดุบูู</button>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุชุณุฌูู ุตูุช:</label>
                    <button id="recordBtn" onclick="toggleRecord()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 w-full mb-2">ุจุฏุก ุงูุชุณุฌูู</button>
                    <button id="playRecordBtn" onclick="playRecording()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 w-full" disabled>ุชุดุบูู ุงูุชุณุฌูู</button>
                </div>
            </div>
        </div>

        <!-- Doctors Management -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">ุฅุฏุงุฑุฉ ุงูุฃุทุจุงุก</h2>
                <button onclick="showAddDoctor()" class="bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700">ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ</button>
            </div>
            <div id="doctorsList" class="space-y-3"></div>
        </div>

        <!-- Video Player Remote Control -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุชุญูู ุจูุดุบู ุงูููุฏูู (ุฌููุน ุงูุดุงุดุงุช)</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <button onclick="videoControl('previous')" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 font-bold">
                    โฎ๏ธ ุงูุณุงุจู
                </button>
                <button onclick="videoControl('play')" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 font-bold">
                    โถ๏ธ ุชุดุบูู
                </button>
                <button onclick="videoControl('pause')" class="bg-yellow-600 text-white px-4 py-3 rounded-lg hover:bg-yellow-700 font-bold">
                    โธ๏ธ ุฅููุงู
                </button>
                <button onclick="videoControl('next')" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 font-bold">
                    โญ๏ธ ุงูุชุงูู
                </button>
                <button onclick="videoControl('mute')" class="bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 font-bold">
                    ๐ ูุชู
                </button>
            </div>
            <div class="mt-4">
                <label class="block text-gray-700 font-bold mb-2">ูุณุชูู ุงูุตูุช:</label>
                <div class="flex gap-4 items-center">
                    <input type="range" id="videoVolumeControl" min="0" max="100" value="50" class="flex-1" onchange="setVideoVolume(this.value)">
                    <span id="videoVolumeDisplay" class="text-gray-700 font-bold w-16">50%</span>
                </div>
            </div>
        </div>

        <!-- Call Statistics & Reports -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">ุชูุงุฑูุฑ ูุฅุญุตุงุฆูุงุช ุงููุฏุงุก</h2>
                <button onclick="loadStatistics()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">ุชุญุฏูุซ</button>
            </div>
            
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 rounded-lg p-4">
                    <p class="text-gray-600 text-sm">ุฅุฌูุงูู ุงููุฏุงุกุงุช ุงูููู</p>
                    <p id="totalCalls" class="text-3xl font-bold text-blue-600">0</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <p class="text-gray-600 text-sm">ุงูุนูุงุฏุงุช ุงููุดุทุฉ</p>
                    <p id="activeClinics" class="text-3xl font-bold text-green-600">0</p>
                </div>
                <div class="bg-yellow-50 rounded-lg p-4">
                    <p class="text-gray-600 text-sm">ูุชูุณุท ููุช ุงูุงูุชุธุงุฑ</p>
                    <p id="avgWaitTime" class="text-3xl font-bold text-yellow-600">0</p>
                    <p class="text-xs text-gray-500">ุฏูููุฉ</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-4">
                    <p class="text-gray-600 text-sm">ุฃูุซุฑ ุนูุงุฏุฉ ูุดุงุทุงู</p>
                    <p id="mostActiveClinic" class="text-lg font-bold text-purple-600">--</p>
                </div>
            </div>

            <!-- Clinic Details -->
            <div id="clinicStatistics" class="space-y-3"></div>

            <!-- Cleanup Options -->
            <div class="mt-6 p-4 bg-red-50 border-l-4 border-red-500 rounded">
                <h3 class="font-bold text-red-800 mb-2">ุตูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช</h3>
                <p class="text-sm text-gray-700 mb-4">ูุชุญุณูู ุงูุฃุฏุงุกุ ููููู ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ุงูุชู ูู ุชุนุฏ ุจุญุงุฌุฉ ุฅูููุง:</p>
                <div class="flex gap-2">
                    <button onclick="cleanupOldData('calls')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm">
                        ๐๏ธ ุญุฐู ุงููุฏุงุกุงุช ุงููุฏููุฉ
                    </button>
                    <button onclick="cleanupOldData('alerts')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm">
                        ๐๏ธ ุญุฐู ุงูุชูุจููุงุช ุงููุฏููุฉ
                    </button>
                    <button onclick="cleanupOldData('all')" class="bg-red-700 text-white px-4 py-2 rounded-lg hover:bg-red-800 text-sm">
                        ๐๏ธ ุญุฐู ูู ุงูุจูุงูุงุช ุงููุคูุชุฉ
                    </button>
                </div>
                <p class="text-xs text-gray-600 mt-2">* ุณูุชู ุงูุงุญุชูุงุธ ุจุงูุนูุงุฏุงุช ูุงูุฃุทุจุงุก ูุงูุฅุนุฏุงุฏุงุช</p>
            </div>
        </div>

        <!-- Back Button -->
        <div class="text-center">
            <a href="index.html" class="inline-block bg-gray-600 text-white px-8 py-3 rounded-lg hover:bg-gray-700">ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
        </div>
    </div>
    </div>

    <!-- Add/Edit Clinic Modal -->
    <div id="clinicModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="modalTitle">ุฅุถุงูุฉ ุนูุงุฏุฉ ุฌุฏูุฏุฉ</h3>
            <div class="space-y-4">
                <input type="hidden" id="editClinicId">
                <div>
                    <label class="block text-gray-700 mb-2">ุงุณู ุงูุนูุงุฏุฉ:</label>
                    <input type="text" id="clinicName" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุฑูู ุงูุนูุงุฏุฉ:</label>
                    <input type="number" id="clinicNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุฑูู ุงูุดุงุดุฉ (ูููู ุงุฎุชูุงุฑ ุฃูุซุฑ ูู ุดุงุดุฉ):</label>
                    <div class="grid grid-cols-4 gap-2">
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="clinic-screen-checkbox" value="1">
                            <span>ุดุงุดุฉ 1</span>
                        </label>
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="clinic-screen-checkbox" value="2">
                            <span>ุดุงุดุฉ 2</span>
                        </label>
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="clinic-screen-checkbox" value="3">
                            <span>ุดุงุดุฉ 3</span>
                        </label>
                        <label class="flex items-center gap-2 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="clinic-screen-checkbox" value="4">
                            <span>ุดุงุดุฉ 4</span>
                        </label>
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ูููุฉ ุงูุณุฑ:</label>
                    <input type="password" id="clinicPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div class="flex gap-4">
                    <button onclick="saveClinic()" class="flex-1 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">ุญูุธ</button>
                    <button onclick="closeModal()" class="flex-1 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">ุฅูุบุงุก</button>
                </div>
            </div>
        </div>
    </div>
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">ุฅุฏุงุฑุฉ ุงูุฃุทุจุงุก ูุงูุนุงูููู</h2>
        <button onclick="showAddDoctorNew()" class="bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700 font-bold">
            โ ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ
        </button>
    </div>
    
    <!-- Search and Filter -->
    <div class="flex gap-4 mb-4">
        <input type="text" id="searchDoctors" placeholder="ุจุญุซ ุจุงูุงุณู ุฃู ุงูุฑูู ุงููุธููู" 
               class="flex-1 px-4 py-2 border border-gray-300 rounded-lg" onkeyup="searchDoctors()">
        <select id="filterSpecialty" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="filterDoctors()">
            <option value="">ูู ุงูุชุฎุตุตุงุช</option>
        </select>
        <select id="filterStatus" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="filterDoctors()">
            <option value="">ูู ุงูุญุงูุงุช</option>
            <option value="ูุดุท">ูุดุท</option>
            <option value="ูุนูู">ูุนูู</option>
            <option value="ูุฌุงุฒุฉ">ูู ุฅุฌุงุฒุฉ</option>
        </select>
    </div>

    <div id="doctorsListNew" class="space-y-3"></div>
</div>
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">ุญุฌูุฒุงุช ุงูููุงุนูุฏ (ุฃูููุงูู)</h2>
        <button onclick="loadAppointments()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700">ุชุญุฏูุซ ุงููุงุฆูุฉ</button>
    </div>
    
    <div class="flex gap-4 mb-4">
        <input type="date" id="filterDate" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="loadAppointments()">
        <select id="filterStatusBooking" class="px-4 py-2 border border-gray-300 rounded-lg" onchange="loadAppointments()">
            <option value="">ูู ุงูุญุงูุงุช</option>
            <option value="ูุญุฌูุฒ">ูุญุฌูุฒ</option>
            <option value="ููุชูู">ููุชูู</option>
            <option value="ููุบู">ููุบู</option>
        </select>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full text-right border-collapse">
            <thead class="bg-gray-100">
                <tr>
                    <th class="p-3 border">ุงูุงุณู</th>
                    <th class="p-3 border">ุงูุนูุงุฏุฉ</th>
                    <th class="p-3 border">ุงูุชุงุฑูุฎ</th>
                    <th class="p-3 border">ุงูููุช</th>
                    <th class="p-3 border">ุงููุงุชู</th>
                    <th class="p-3 border">ุงูุญุงูุฉ</th>
                    <th class="p-3 border">ุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody id="appointmentsListTable">
                <tr><td colspan="7" class="text-center p-4">ุฌุงุฑู ุงูุชุญููู...</td></tr>
            </tbody>
        </table>
    </div>
</div>
<!-- Attendance Management -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">ุฅุฏุงุฑุฉ ุงูุญุถูุฑ ูุงูุงูุตุฑุงู</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label class="block text-gray-700 font-bold mb-2">ุงุฎุชุฑ ุงูุทุจูุจ:</label>
            <select id="attendanceDoctor" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="">ุงุฎุชุฑ ุงูุทุจูุจ</option>
            </select>
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">ุงูุชุงุฑูุฎ:</label>
            <input type="date" id="attendanceDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
            <label class="block text-gray-700 font-bold mb-2">ููุช ุงูุญุถูุฑ:</label>
            <input type="time" id="checkInTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">ููุช ุงูุงูุตุฑุงู:</label>
            <input type="time" id="checkOutTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">ุงูุญุงูุฉ:</label>
            <select id="attendanceStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="ุญุงุถุฑ">ุญุงุถุฑ</option>
                <option value="ุบุงุฆุจ">ุบุงุฆุจ</option>
                <option value="ุฅุฌุงุฒุฉ">ุฅุฌุงุฒุฉ</option>
                <option value="ูุฃููุฑูุฉ">ูุฃููุฑูุฉ</option>
            </select>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label class="block text-gray-700 font-bold mb-2">ุงูุดููุช:</label>
            <select id="attendanceShift" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                <option value="ุตุจุงุญู">ุตุจุงุญู</option>
                <option value="ูุณุงุฆู">ูุณุงุฆู</option>
            </select>
        </div>
        <div>
            <label class="block text-gray-700 font-bold mb-2">ููุงุญุธุงุช:</label>
            <input type="text" id="attendanceNotes" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ููุงุญุธุงุช ุงุฎุชูุงุฑูุฉ">
        </div>
    </div>

    <button onclick="saveAttendance()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 font-bold">
        ๐พ ุญูุธ ุจูุงูุงุช ุงูุญุถูุฑ
    </button>

    <div class="mt-6">
        <h3 class="text-lg font-bold text-gray-800 mb-3">ุฑูุน ููู Excel ููุญุถูุฑ ุงูุดูุฑู</h3>
        <div class="flex gap-4">
            <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">
            <button onclick="uploadAttendanceExcel()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-bold">
                ๐ค ุฑูุน ููู
            </button>
        </div>
        <p class="text-sm text-gray-600 mt-2">* ุงูููู ูุฌุจ ุฃู ูุญุชูู ุนูู: ุฑูู ุงูุทุจูุจุ ุงูุชุงุฑูุฎุ ุงูุญุถูุฑุ ุงูุงูุตุฑุงูุ ุงูุญุงูุฉุ ุงูุดููุช</p>
    </div>
</div>

<!-- Requests Management -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุนุงูููู</h2>
        <div class="flex gap-2">
            <button onclick="filterAdminRequests('all')" class="admin-filter-btn bg-gray-200 px-4 py-2 rounded-lg font-bold">
                ุงููู <span id="countAll">0</span>
            </button>
            <button onclick="filterAdminRequests('pending')" class="admin-filter-btn px-4 py-2 rounded-lg font-bold">
                ููุฏ ุงููุฑุงุฌุนุฉ <span id="countPending" class="bg-yellow-500 text-white px-2 py-1 rounded-full text-xs ml-1">0</span>
            </button>
            <button onclick="filterAdminRequests('approved')" class="admin-filter-btn px-4 py-2 rounded-lg font-bold">
                ููุงูู <span id="countApproved">0</span>
            </button>
            <button onclick="filterAdminRequests('rejected')" class="admin-filter-btn px-4 py-2 rounded-lg font-bold">
                ูุฑููุถ <span id="countRejected">0</span>
            </button>
        </div>
    </div>

    <div id="adminRequestsList" class="space-y-4"></div>
</div>

<!-- Complaints and Suggestions -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-800">ุงูุดูุงูู ูุงูุงูุชุฑุงุญุงุช</h2>
        <div class="flex gap-2">
            <button onclick="filterComplaints('all')" class="complaint-filter-btn bg-gray-200 px-4 py-2 rounded-lg font-bold">ุงููู</button>
            <button onclick="filterComplaints('ุดููู')" class="complaint-filter-btn px-4 py-2 rounded-lg font-bold">ุงูุดูุงูู</button>
            <button onclick="filterComplaints('ุงูุชุฑุงุญ')" class="complaint-filter-btn px-4 py-2 rounded-lg font-bold">ุงูุงูุชุฑุงุญุงุช</button>
            <button onclick="filterComplaints('new')" class="complaint-filter-btn px-4 py-2 rounded-lg font-bold">
                ุฌุฏูุฏ <span id="newComplaintsCount" class="bg-red-500 text-white px-2 py-1 rounded-full text-xs ml-1">0</span>
            </button>
        </div>
    </div>

    <div id="complaintsList" class="space-y-4"></div>
</div>

<!-- Add/Edit Doctor Modal -->
<div id="doctorModalNew" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
    <div class="bg-white rounded-lg p-8 max-w-3xl w-full mx-4 my-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-4" id="doctorModalTitleNew">ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ</h3>
        <div class="space-y-4">
            <input type="hidden" id="editDoctorIdNew">
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุฑูู ุงูุทุจูุจ ุงููุธููู:</label>
                    <input type="text" id="doctorEmployeeNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุงูุงุณู:</label>
                    <input type="text" id="doctorNameNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุฑูู ุงููุงุชู:</label>
                    <input type="tel" id="doctorPhoneNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุงูุฑูู ุงููููู:</label>
                    <input type="text" id="doctorNationalId" class="w-full px-4 py-2 border border-gray-300 rounded-lg" maxlength="14">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุงูุชุฎุตุต:</label>
                    <input type="text" id="doctorSpecialtyNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุงูุนูุงุฏุฉ:</label>
                    <select id="doctorClinicNew" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></select>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุญุงูุฉ ุงูุนูู:</label>
                    <select id="doctorWorkStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="ูุดุท">ูุดุท</option>
                        <option value="ูุนูู">ูุนูู</option>
                        <option value="ูุฌุงุฒุฉ">ูู ุฅุฌุงุฒุฉ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุงูุดููุช:</label>
                    <select id="doctorShift" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="ุตุจุงุญู">ุตุจุงุญู</option>
                        <option value="ูุณุงุฆู">ูุณุงุฆู</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-2">ุฃูุงู ุงูุนูู:</label>
                <div class="grid grid-cols-7 gap-2">
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="ุงูุฃุญุฏ">
                        <span class="text-xs">ุงูุฃุญุฏ</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="ุงูุฅุซููู">
                        <span class="text-xs">ุงูุฅุซููู</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="ุงูุซูุงุซุงุก">
                        <span class="text-xs">ุงูุซูุงุซุงุก</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="ุงูุฃุฑุจุนุงุก">
                        <span class="text-xs">ุงูุฃุฑุจุนุงุก</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="ุงูุฎููุณ">
                        <span class="text-xs">ุงูุฎููุณ</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="ุงูุฌูุนุฉ">
                        <span class="text-xs">ุงูุฌูุนุฉ</span>
                    </label>
                    <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                        <input type="checkbox" class="doctor-day-checkbox-new" value="ุงูุณุจุช">
                        <span class="text-xs">ุงูุณุจุช</span>
                    </label>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุฑุตูุฏ ุงูุฅุฌุงุฒุงุช ุงูุงุนุชูุงุฏูุฉ:</label>
                    <input type="number" id="doctorRegularLeave" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="21">
                </div>
                <div>
                    <label class="block text-gray-700 font-bold mb-2">ุฑุตูุฏ ุงูุฅุฌุงุฒุงุช ุงูุนุงุฑุถุฉ:</label>
                    <input type="number" id="doctorCasualLeave" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="7">
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</label>
                <input type="email" id="doctorEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="doctor@example.com">
            </div>

            <div id="passwordSection">
                <label class="block text-gray-700 font-bold mb-2">ูููุฉ ุงูุณุฑ (ููุฏุฎูู ูููุธุงู):</label>
                <input type="password" id="doctorPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ูููุฉ ุณุฑ ูููุฉ">
                <p class="text-xs text-gray-500 mt-1">* ุณูุชู ุฅูุดุงุก ุญุณุงุจ ููุทุจูุจ ูู Firebase Authentication</p>
            </div>

            <div>
                <label class="block text-gray-700 font-bold mb-2">ููุงุญุธุงุช:</label>
                <textarea id="doctorNotesNew" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea>
            </div>

            <div class="flex gap-4">
                <button onclick="saveDoctorNew()" class="flex-1 bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700 font-bold">ุญูุธ</button>
                <button onclick="closeDoctorModalNew()" class="flex-1 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 font-bold">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>
</div>

<!-- Request Review Modal -->
<div id="requestReviewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">ูุฑุงุฌุนุฉ ุงูุทูุจ</h3>
        <div id="requestReviewContent" class="space-y-4 mb-6"></div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 font-bold mb-2">ุฑุฏ ุงูุฅุฏุงุฑุฉ:</label>
                <textarea id="adminResponseText" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ุงูุชุจ ุฑุฏ ุงูุฅุฏุงุฑุฉ ููุง (ุงุฎุชูุงุฑู)"></textarea>
            </div>

            <div class="flex gap-4">
                <button onclick="reviewRequest('approve')" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-bold">
                    โ ุงูููุงููุฉ ุนูู ุงูุทูุจ
                </button>
                <button onclick="reviewRequest('reject')" class="flex-1 bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-bold">
                    โ ุฑูุถ ุงูุทูุจ
                </button>
                <button onclick="closeRequestReviewModal()" class="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 font-bold">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Complaint Response Modal -->
<div id="complaintResponseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">ุงูุฑุฏ ุนูู ุงูุดููู/ุงูุงูุชุฑุงุญ</h3>
        <div id="complaintContent" class="space-y-4 mb-6"></div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-gray-700 font-bold mb-2">ุฑุฏ ุงูุฅุฏุงุฑุฉ:</label>
                <textarea id="complaintResponseText" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ุงูุชุจ ุงูุฑุฏ ููุง"></textarea>
            </div>

            <div class="flex gap-4">
                <button onclick="sendComplaintResponse()" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-bold">
                    ๐ค ุฅุฑุณุงู ุงูุฑุฏ
                </button>
                <button onclick="closeComplaintResponseModal()" class="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 font-bold">
                    ุฅูุบุงุก
                </button>
            </div>
        </div>
    </div>
</div>
    <!-- Add/Edit Doctor Modal -->
    <div id="doctorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 my-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4" id="doctorModalTitle">ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ</h3>
            <div class="space-y-4">
                <input type="hidden" id="editDoctorId">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ุงูุงุณู:</label>
                        <input type="text" id="doctorName" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ุงูููุจ:</label>
                        <input type="text" id="doctorTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ุฏ. / ุฃ.ุฏ. / ุงุณุชุดุงุฑู">
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุงูุนูุงุฏุฉ:</label>
                    <select id="doctorClinic" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></select>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุฑุงุจุท ุงูุตูุฑุฉ (URL):</label>
                    <input type="text" id="doctorImage" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="https://example.com/image.jpg">
                    <p class="text-xs text-gray-500 mt-1">ุฃู ุงุฑูุน ุงูุตูุฑุฉ ุนูู Imgur/Firebase Storage ูุถุน ุงูุฑุงุจุท</p>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ุฃูุงู ุงูุนูู:</label>
                    <div class="grid grid-cols-7 gap-2">
                        <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="doctor-day-checkbox" value="ุงูุฃุญุฏ">
                            <span class="text-xs">ุงูุฃุญุฏ</span>
                        </label>
                        <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="doctor-day-checkbox" value="ุงูุฅุซููู">
                            <span class="text-xs">ุงูุฅุซููู</span>
                        </label>
                        <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="doctor-day-checkbox" value="ุงูุซูุงุซุงุก">
                            <span class="text-xs">ุงูุซูุงุซุงุก</span>
                        </label>
                        <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="doctor-day-checkbox" value="ุงูุฃุฑุจุนุงุก">
                            <span class="text-xs">ุงูุฃุฑุจุนุงุก</span>
                        </label>
                        <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="doctor-day-checkbox" value="ุงูุฎููุณ">
                            <span class="text-xs">ุงูุฎููุณ</span>
                        </label>
                        <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="doctor-day-checkbox" value="ุงูุฌูุนุฉ">
                            <span class="text-xs">ุงูุฌูุนุฉ</span>
                        </label>
                        <label class="flex flex-col items-center gap-1 bg-gray-50 p-2 rounded cursor-pointer hover:bg-gray-100">
                            <input type="checkbox" class="doctor-day-checkbox" value="ุงูุณุจุช">
                            <span class="text-xs">ุงูุณุจุช</span>
                        </label>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-2">ุงูุชูููู (1-5):</label>
                        <input type="number" id="doctorRating" class="w-full px-4 py-2 border border-gray-300 rounded-lg" min="1" max="5" step="0.1" value="5">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">ุฑูู ุงูุชููููู:</label>
                        <input type="tel" id="doctorPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="01234567890">
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">ููุงุญุธุงุช:</label>
                    <textarea id="doctorNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
                </div>
                <div class="flex gap-4">
                    <button onclick="saveDoctor()" class="flex-1 bg-teal-600 text-white px-6 py-2 rounded-lg hover:bg-teal-700">ุญูุธ</button>
                    <button onclick="closeDoctorModal()" class="flex-1 bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">ุฅูุบุงุก</button>
                </div>
            </div>
        </div>
    </div>

    <script>

        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyArFKjBYsFhsPyJPJpjLhH2eSEHlUFEzhI",
  authDomain: "queue-717d5.firebaseapp.com",
  databaseURL: "https://queue-717d5-default-rtdb.firebaseio.com",
  projectId: "queue-717d5",
  storageBucket: "queue-717d5.firebasestorage.app",
  messagingSenderId: "837806460328",
  appId: "1:837806460328:web:f2070b93a2784b1b25619d",
  measurementId: "G-GM30LE46F6"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database(); // Realtime Database
const auth = firebase.auth();
const firestore = firebase.firestore(); // Firestore

        let mediaRecorder;
        let recordedChunks = [];
        let recordedBlob;
        let currentUser = null;

        // Check authentication status
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadSettings();
                loadClinics();
            } else {
                currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('adminPanel').classList.add('hidden');
            }
        });

        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            if (!email || !password) {
                alert('ูุฑุฌู ุฅุฏุฎุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงูุณุฑ');
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    console.log('ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ');
                })
                .catch((error) => {
                    alert('ุฎุทุฃ ูู ุชุณุฌูู ุงูุฏุฎูู: ' + error.message);
                });
        }

        function adminLogout() {
            if (confirm('ูู ุชุฑูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
                auth.signOut();
            }
        }

        function loadSettings() {
            db.ref('settings').once('value', (snapshot) => {
                const settings = snapshot.val() || {};
                document.getElementById('centerName').value = settings.centerName || 'ุงููุฑูุฒ ุงูุทุจู';
                document.getElementById('newsContent').value = settings.newsContent || 'ูุฑุญุจุงู ุจูู ูู ุงููุฑูุฒ ุงูุทุจู';
                document.getElementById('newsSpeed').value = settings.newsSpeed || 50;
                document.getElementById('alertDuration').value = settings.alertDuration || 5;
                document.getElementById('audioPath').value = settings.audioPath || 'audio/';
                document.getElementById('videoPath').value = settings.videoPath || 'media/';
                document.getElementById('speechRate').value = settings.speechRate || 1;
            });
        }

        function saveCenterName() {
            const name = document.getElementById('centerName').value;
            db.ref('settings/centerName').set(name);
            alert('ุชู ุญูุธ ุงุณู ุงููุฑูุฒ');
        }

        function saveNews() {
            const content = document.getElementById('newsContent').value;
            const speed = document.getElementById('newsSpeed').value;
            db.ref('settings').update({
                newsContent: content,
                newsSpeed: parseInt(speed)
            });
            alert('ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุท ุงูุฅุฎุจุงุฑู');
        }

        function saveAlertDuration() {
            const duration = document.getElementById('alertDuration').value;
            db.ref('settings/alertDuration').set(parseInt(duration));
            alert('ุชู ุญูุธ ูุฏุฉ ุงูุชูุจูู');
        }

        function saveAutoCleanup() {
            const enabled = document.getElementById('autoCleanup').checked;
            db.ref('settings/autoCleanup').set(enabled);
            
            if (enabled) {
                // Schedule cleanup for midnight
                scheduleAutoCleanup();
            }
            
            alert('ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุชูุธูู ุงูุชููุงุฆู');
        }

        function scheduleAutoCleanup() {
            // Calculate time until midnight
            const now = new Date();
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);
            const timeUntilMidnight = midnight - now;

            setTimeout(() => {
                performAutoCleanup();
                // Schedule next cleanup (24 hours)
                setInterval(performAutoCleanup, 24 * 60 * 60 * 1000);
            }, timeUntilMidnight);
        }

        function performAutoCleanup() {
            const oneDayAgo = Date.now() - (24 * 60 * 60 * 1000);
            
            // Clean calls older than 24 hours
            db.ref('calls').orderByChild('timestamp').endAt(oneDayAgo).once('value', (snapshot) => {
                snapshot.forEach(child => {
                    child.ref.remove();
                });
            });

            // Clean alerts older than 24 hours
            db.ref('alerts').orderByChild('timestamp').endAt(oneDayAgo).once('value', (snapshot) => {
                snapshot.forEach(child => {
                    child.ref.remove();
                });
            });

            // Clean doctor alerts older than 24 hours
            db.ref('doctorAlerts').orderByChild('timestamp').endAt(oneDayAgo).once('value', (snapshot) => {
                snapshot.forEach(child => {
                    child.ref.remove();
                });
            });

            // Clean control alerts older than 24 hours
            db.ref('controlAlerts').orderByChild('timestamp').endAt(oneDayAgo).once('value', (snapshot) => {
                snapshot.forEach(child => {
                    child.ref.remove();
                });
            });

            console.log('Auto-cleanup completed at:', new Date().toLocaleString('ar-EG'));
        }

        function saveMediaSettings() {
            const audioPath = document.getElementById('audioPath').value;
            const videoPath = document.getElementById('videoPath').value;
            const videoListText = document.getElementById('videoList').value;
            const useLocalVideos = document.getElementById('useLocalVideos').checked;
            const localVideoPath = document.getElementById('localVideoPath').value;
            
            const videoList = videoListText.split('\n').filter(v => v.trim()).map(v => v.trim());
            
            db.ref('settings').update({
                audioPath: audioPath,
                videoPath: videoPath,
                videoList: videoList,
                useLocalVideos: useLocalVideos,
                localVideoPath: localVideoPath
            });
            alert('ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุตูุช ูุงูููุฏูู');
        }

        function sendControlAlert() {
            const clinicId = document.getElementById('controlAlertClinic').value;
            const message = document.getElementById('controlAlertMessage').value;
            
            if (!clinicId || !message) {
                alert('ูุฑุฌู ุงุฎุชูุงุฑ ุงูุนูุงุฏุฉ ููุชุงุจุฉ ุงูุฑุณุงูุฉ');
                return;
            }

            db.ref('controlAlerts').push({
                clinicId: clinicId,
                message: message,
                timestamp: Date.now()
            });

            alert('ุชู ุฅุฑุณุงู ุงูุชูุจูู ูุตูุญุฉ ุงูุชุญูู');
            document.getElementById('controlAlertMessage').value = '';
        }

        function loadClinics() {
            db.ref('clinics').on('value', (snapshot) => {
                const clinics = snapshot.val() || {};
                const clinicsList = document.getElementById('clinicsList');
                const callSelect = document.getElementById('callClinicSelect');
                const controlAlertSelect = document.getElementById('controlAlertClinic');
                const doctorClinicSelect = document.getElementById('doctorClinic');
                
                clinicsList.innerHTML = '';
                callSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุนูุงุฏุฉ</option>';
                controlAlertSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุนูุงุฏุฉ</option>';
                doctorClinicSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุนูุงุฏุฉ</option>';
                
                Object.keys(clinics).forEach(id => {
                    const clinic = clinics[id];
                    const screens = Array.isArray(clinic.screens) ? clinic.screens.join(', ') : clinic.screen;
                    
                    // Add to list
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';
                    div.innerHTML = `
                        <div>
                            <span class="font-bold">${clinic.name}</span>
                            <span class="text-gray-600 mr-4">ุฑูู: ${clinic.number}</span>
                            <span class="text-gray-600 mr-4">ุดุงุดุงุช: ${screens}</span>
                            <span class="text-gray-600 mr-4">ุงูุฑูู ุงูุญุงูู: ${clinic.currentNumber || 0}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editClinic('${id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ุชุนุฏูู</button>
                            <button onclick="deleteClinic('${id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ุญุฐู</button>
                        </div>
                    `;
                    clinicsList.appendChild(div);
                    
                    // Add to selects
                    [callSelect, controlAlertSelect, doctorClinicSelect].forEach(select => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = clinic.name;
                        select.appendChild(option);
                    });
                });
            });
        }

        function showAddClinic() {
            document.getElementById('modalTitle').textContent = 'ุฅุถุงูุฉ ุนูุงุฏุฉ ุฌุฏูุฏุฉ';
            document.getElementById('editClinicId').value = '';
            document.getElementById('clinicName').value = '';
            document.getElementById('clinicNumber').value = '';
            document.getElementById('clinicPassword').value = '';
            document.querySelectorAll('.clinic-screen-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('clinicModal').classList.remove('hidden');
        }

        function editClinic(id) {
            db.ref('clinics/' + id).once('value', (snapshot) => {
                const clinic = snapshot.val();
                document.getElementById('modalTitle').textContent = 'ุชุนุฏูู ุงูุนูุงุฏุฉ';
                document.getElementById('editClinicId').value = id;
                document.getElementById('clinicName').value = clinic.name;
                document.getElementById('clinicNumber').value = clinic.number;
                document.getElementById('clinicPassword').value = clinic.password;
                
                // Set screens checkboxes
                const screens = Array.isArray(clinic.screens) ? clinic.screens : [clinic.screen];
                document.querySelectorAll('.clinic-screen-checkbox').forEach(cb => {
                    cb.checked = screens.includes(parseInt(cb.value));
                });
                
                document.getElementById('clinicModal').classList.remove('hidden');
            });
        }

        function saveClinic() {
            const id = document.getElementById('editClinicId').value;
            const name = document.getElementById('clinicName').value;
            const number = document.getElementById('clinicNumber').value;
            const password = document.getElementById('clinicPassword').value;
            
            const screens = Array.from(document.querySelectorAll('.clinic-screen-checkbox:checked'))
                .map(cb => parseInt(cb.value));

            if (!name || !number || !password || screens.length === 0) {
                alert('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ูุงุฎุชูุงุฑ ุดุงุดุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู');
                return;
            }

            const clinicData = {
                name: name,
                number: parseInt(number),
                screens: screens,
                password: password,
                currentNumber: 0,
                status: 'active',
                lastCall: null
            };

            if (id) {
                db.ref('clinics/' + id).update(clinicData);
            } else {
                db.ref('clinics').push(clinicData);
            }

            closeModal();
            alert('ุชู ุญูุธ ุงูุนูุงุฏุฉ');
        }

        function deleteClinic(id) {
            if (confirm('ูู ุชุฑูุฏ ุญุฐู ูุฐู ุงูุนูุงุฏุฉุ')) {
                db.ref('clinics/' + id).remove();
                alert('ุชู ุญุฐู ุงูุนูุงุฏุฉ');
            }
        }

        function closeModal() {
            document.getElementById('clinicModal').classList.add('hidden');
        }

        function callCustomer() {
            const clinicId = document.getElementById('callClinicSelect').value;
            const number = document.getElementById('callNumber').value;

            if (!clinicId || !number) {
                alert('ูุฑุฌู ุงุฎุชูุงุฑ ุงูุนูุงุฏุฉ ูุฑูู ุงูุนููู');
                return;
            }

            db.ref('clinics/' + clinicId).once('value', (snapshot) => {
                const clinic = snapshot.val();
                const callData = {
                    clinicId: clinicId,
                    clinicName: clinic.name,
                    number: parseInt(number),
                    timestamp: Date.now()
                };

                db.ref('calls').push(callData);
                db.ref('clinics/' + clinicId).update({
                    currentNumber: parseInt(number),
                    lastCall: Date.now()
                });

                alert('ุชู ูุฏุงุก ุงูุนููู ุฑูู ' + number);
            });
        }

        function sendAlert() {
            const message = document.getElementById('alertMessage').value;
            if (!message) {
                alert('ูุฑุฌู ูุชุงุจุฉ ุฑุณุงูุฉ ุงูุชูุจูู');
                return;
            }

            db.ref('alerts').push({
                message: message,
                timestamp: Date.now()
            });

            alert('ุชู ุฅุฑุณุงู ุงูุชูุจูู');
            document.getElementById('alertMessage').value = '';
        }

        function resetAllClinics() {
            if (confirm('ูู ุชุฑูุฏ ุชุตููุฑ ุฌููุน ุงูุนูุงุฏุงุชุ')) {
                db.ref('clinics').once('value', (snapshot) => {
                    const clinics = snapshot.val() || {};
                    Object.keys(clinics).forEach(id => {
                        db.ref('clinics/' + id).update({
                            currentNumber: 0,
                            lastCall: null
                        });
                    });
                });
                alert('ุชู ุชุตููุฑ ุฌููุน ุงูุนูุงุฏุงุช');
            }
        }

        function playInstant() {
            const file = document.getElementById('instantAudio').value;
            if (!file) {
                alert('ูุฑุฌู ุงุฎุชูุงุฑ ููู');
                return;
            }

            // Play audio locally
            const audio = new Audio('audio/' + file);
            audio.play();

            // Broadcast to all display screens
            db.ref('instantAudio').push({
                file: file,
                timestamp: Date.now()
            });
        }

        // Doctors Management
        function showAddDoctor() {
            document.getElementById('doctorModalTitle').textContent = 'ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ';
            document.getElementById('editDoctorId').value = '';
            document.getElementById('doctorName').value = '';
            document.getElementById('doctorTitle').value = '';
            document.getElementById('doctorClinic').value = '';
            document.getElementById('doctorImage').value = '';
            document.getElementById('doctorRating').value = '5';
            document.getElementById('doctorPhone').value = '';
            document.getElementById('doctorNotes').value = '';
            document.querySelectorAll('.doctor-day-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('doctorModal').classList.remove('hidden');
        }

        function editDoctor(id) {
            db.ref('doctors/' + id).once('value', (snapshot) => {
                const doctor = snapshot.val();
                document.getElementById('doctorModalTitle').textContent = 'ุชุนุฏูู ุงูุทุจูุจ';
                document.getElementById('editDoctorId').value = id;
                document.getElementById('doctorName').value = doctor.name;
                document.getElementById('doctorTitle').value = doctor.title || '';
                document.getElementById('doctorClinic').value = doctor.clinicId;
                document.getElementById('doctorImage').value = doctor.image || '';
                document.getElementById('doctorRating').value = doctor.rating || 5;
                document.getElementById('doctorPhone').value = doctor.phone || '';
                document.getElementById('doctorNotes').value = doctor.notes || '';
                
                const days = doctor.workDays || [];
                document.querySelectorAll('.doctor-day-checkbox').forEach(cb => {
                    cb.checked = days.includes(cb.value);
                });
                
                document.getElementById('doctorModal').classList.remove('hidden');
            });
        }

        function saveDoctor() {
            const id = document.getElementById('editDoctorId').value;
            const name = document.getElementById('doctorName').value;
            const title = document.getElementById('doctorTitle').value;
            const clinicId = document.getElementById('doctorClinic').value;
            const image = document.getElementById('doctorImage').value;
            const rating = parseFloat(document.getElementById('doctorRating').value);
            const phone = document.getElementById('doctorPhone').value;
            const notes = document.getElementById('doctorNotes').value;
            
            const workDays = Array.from(document.querySelectorAll('.doctor-day-checkbox:checked'))
                .map(cb => cb.value);

            if (!name || !clinicId) {
                alert('ูุฑุฌู ููุก ุงูุญููู ุงูุฃุณุงุณูุฉ (ุงูุงุณู ูุงูุนูุงุฏุฉ)');
                return;
            }

            const doctorData = {
                name: name,
                title: title,
                clinicId: clinicId,
                image: image,
                workDays: workDays,
                rating: rating,
                phone: phone,
                notes: notes,
                updatedAt: Date.now()
            };

            if (id) {
                db.ref('doctors/' + id).update(doctorData);
            } else {
                db.ref('doctors').push(doctorData);
            }

            closeDoctorModal();
            alert('ุชู ุญูุธ ุจูุงูุงุช ุงูุทุจูุจ');
            loadDoctors();
        }

        function deleteDoctor(id) {
            if (confirm('ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูุทุจูุจุ')) {
                db.ref('doctors/' + id).remove();
                alert('ุชู ุญุฐู ุงูุทุจูุจ');
            }
        }

        function loadDoctors() {
            db.ref('doctors').on('value', (snapshot) => {
                const doctors = snapshot.val() || {};
                const doctorsList = document.getElementById('doctorsList');
                doctorsList.innerHTML = '';
                
                db.ref('clinics').once('value', (clinicsSnapshot) => {
                    const clinics = clinicsSnapshot.val() || {};
                    
                    Object.keys(doctors).forEach(id => {
                        const doctor = doctors[id];
                        const clinic = clinics[doctor.clinicId] || {};
                        
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';
                        div.innerHTML = `
                            <div class="flex items-center gap-4">
                                <img src="${doctor.image || 'https://via.placeholder.com/80'}" class="w-20 h-20 rounded-full object-cover" onerror="this.src='https://via.placeholder.com/80'">
                                <div>
                                    <p class="font-bold text-lg">${doctor.title} ${doctor.name}</p>
                                    <p class="text-gray-600">ุงูุนูุงุฏุฉ: ${clinic.name || 'ุบูุฑ ูุญุฏุฏ'}</p>
                                    <p class="text-gray-600 text-sm">ุฃูุงู ุงูุนูู: ${(doctor.workDays || []).join(', ') || 'ุบูุฑ ูุญุฏุฏ'}</p>
                                    <p class="text-yellow-600">โญ ${doctor.rating || 5}</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editDoctor('${id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ุชุนุฏูู</button>
                                <button onclick="deleteDoctor('${id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ุญุฐู</button>
                            </div>
                        `;
                        doctorsList.appendChild(div);
                    });
                });
            });
        }

        function closeDoctorModal() {
            document.getElementById('doctorModal').classList.add('hidden');
        }

        // Load doctors on page load
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadSettings();
                loadClinics();
                loadDoctors();
            } else {
                currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('adminPanel').classList.add('hidden');
            }
        });

        async function toggleRecord() {
            const btn = document.getElementById('recordBtn');
            
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];

                    mediaRecorder.ondataavailable = (e) => {
                        if (e.data.size > 0) {
                            recordedChunks.push(e.data);
                        }
                    };

                    mediaRecorder.onstop = () => {
                        recordedBlob = new Blob(recordedChunks, { type: 'audio/webm' });
                        document.getElementById('playRecordBtn').disabled = false;
                    };

                    mediaRecorder.start();
                    btn.textContent = 'ุฅููุงู ุงูุชุณุฌูู';
                    btn.classList.remove('bg-red-600', 'hover:bg-red-700');
                    btn.classList.add('bg-yellow-600', 'hover:bg-yellow-700');
                } catch (err) {
                    alert('ุฎุทุฃ ูู ุงููุตูู ูููููุฑูููู');
                }
            } else {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
                btn.textContent = 'ุจุฏุก ุงูุชุณุฌูู';
                btn.classList.remove('bg-yellow-600', 'hover:bg-yellow-700');
                btn.classList.add('bg-red-600', 'hover:bg-red-700');
            }
        }

        function playRecording() {
            if (recordedBlob) {
                const audio = new Audio(URL.createObjectURL(recordedBlob));
                audio.play();
            }
        }





// ุฃุถู ูุฐุง ุงูููุฏ ูู ููุงูุฉ script ูู admin.html

// Load doctors list
async function loadDoctorsNew() {
    try {
        const doctorsSnap = await firestore.collection('doctors').get();
        const listDiv = document.getElementById('doctorsListNew');
        
        if (doctorsSnap.empty) {
            listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">ูุง ููุฌุฏ ุฃุทุจุงุก</p>';
            return;
        }

        // Get specialties for filter
        const specialties = new Set();
        
        listDiv.innerHTML = '';
        doctorsSnap.forEach(doc => {
            const doctor = { id: doc.id, ...doc.data() };
            specialties.add(doctor.specialty);
            
            const statusColor = doctor.workStatus === 'ูุดุท' ? 'text-green-600' : 
                               doctor.workStatus === 'ูุนูู' ? 'text-red-600' : 'text-yellow-600';
            
            listDiv.innerHTML += `
                <div class="doctor-item flex items-center justify-between p-4 bg-gray-50 rounded-lg" 
                     data-specialty="${doctor.specialty}" data-status="${doctor.workStatus}">
                    <div class="flex-1">
                        <div class="flex items-center gap-4 mb-2">
                            <h4 class="text-lg font-bold text-gray-800">${doctor.name}</h4>
                            <span class="text-sm text-gray-600">ุฑูู: ${doctor.employeeNumber}</span>
                            <span class="${statusColor} font-bold text-sm">${doctor.workStatus}</span>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-600">
                            <p><strong>ุงูุชุฎุตุต:</strong> ${doctor.specialty}</p>
                            <p><strong>ุงููุงุชู:</strong> ${doctor.phone}</p>
                            <p><strong>ุงูุดููุช:</strong> ${doctor.shift}</p>
                            <p><strong>ุงูุฅุฌุงุฒุงุช:</strong> ${doctor.regularLeaveBalance || 0} / ${doctor.casualLeaveBalance || 0}</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="viewDoctorReport('${doctor.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ุชูุฑูุฑ</button>
                        <button onclick="editDoctorNew('${doctor.id}')" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">ุชุนุฏูู</button>
                        <button onclick="deleteDoctorNew('${doctor.id}')" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ุญุฐู</button>
                    </div>
                </div>
            `;
        });

        // Update specialty filter
        const filterSelect = document.getElementById('filterSpecialty');
        filterSelect.innerHTML = '<option value="">ูู ุงูุชุฎุตุตุงุช</option>';
        specialties.forEach(spec => {
            filterSelect.innerHTML += `<option value="${spec}">${spec}</option>`;
        });

        // Update attendance doctor select
        const attendanceSelect = document.getElementById('attendanceDoctor');
        attendanceSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุงูุทุจูุจ</option>';
        doctorsSnap.forEach(doc => {
            const doctor = doc.data();
            attendanceSelect.innerHTML += `<option value="${doc.id}">${doctor.name} - ${doctor.employeeNumber}</option>`;
        });

    } catch (error) {
        console.error('Error loading doctors:', error);
    }
}

function searchDoctors() {
    const search = document.getElementById('searchDoctors').value.toLowerCase();
    const items = document.querySelectorAll('.doctor-item');
    
    items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(search) ? 'flex' : 'none';
    });
}

function filterDoctors() {
    const specialty = document.getElementById('filterSpecialty').value;
    const status = document.getElementById('filterStatus').value;
    const items = document.querySelectorAll('.doctor-item');
    
    items.forEach(item => {
        const itemSpecialty = item.dataset.specialty;
        const itemStatus = item.dataset.status;
        
        const matchSpecialty = !specialty || itemSpecialty === specialty;
        const matchStatus = !status || itemStatus === status;
        
        item.style.display = (matchSpecialty && matchStatus) ? 'flex' : 'none';
    });
}

function showAddDoctorNew() {
    document.getElementById('doctorModalTitleNew').textContent = 'ุฅุถุงูุฉ ุทุจูุจ ุฌุฏูุฏ';
    document.getElementById('editDoctorIdNew').value = '';
    document.getElementById('doctorEmployeeNumber').value = '';
    document.getElementById('doctorNameNew').value = '';
    document.getElementById('doctorPhoneNew').value = '';
    document.getElementById('doctorNationalId').value = '';
    document.getElementById('doctorSpecialtyNew').value = '';
    document.getElementById('doctorClinicNew').value = '';
    document.getElementById('doctorWorkStatus').value = 'ูุดุท';
    document.getElementById('doctorShift').value = 'ุตุจุงุญู';
    document.getElementById('doctorRegularLeave').value = '21';
    document.getElementById('doctorCasualLeave').value = '7';
    document.getElementById('doctorEmail').value = '';
    document.getElementById('doctorPassword').value = '';
    document.getElementById('doctorNotesNew').value = '';
    document.querySelectorAll('.doctor-day-checkbox-new').forEach(cb => cb.checked = false);
    document.getElementById('passwordSection').style.display = 'block';
    
    // Load clinics
    loadClinicsForDoctor();
    
    document.getElementById('doctorModalNew').classList.remove('hidden');
}

async function editDoctorNew(id) {
    try {
        const doc = await firestore.collection('doctors').doc(id).get();
        const doctor = doc.data();
        
        document.getElementById('doctorModalTitleNew').textContent = 'ุชุนุฏูู ุจูุงูุงุช ุงูุทุจูุจ';
        document.getElementById('editDoctorIdNew').value = id;
        document.getElementById('doctorEmployeeNumber').value = doctor.employeeNumber;
        document.getElementById('doctorNameNew').value = doctor.name;
        document.getElementById('doctorPhoneNew').value = doctor.phone;
        document.getElementById('doctorNationalId').value = doctor.nationalId;
        document.getElementById('doctorSpecialtyNew').value = doctor.specialty;
        document.getElementById('doctorClinicNew').value = doctor.clinicId;
        document.getElementById('doctorWorkStatus').value = doctor.workStatus;
        document.getElementById('doctorShift').value = doctor.shift;
        document.getElementById('doctorRegularLeave').value = doctor.regularLeaveBalance;
        document.getElementById('doctorCasualLeave').value = doctor.casualLeaveBalance;
        document.getElementById('doctorEmail').value = doctor.email;
        document.getElementById('doctorNotesNew').value = doctor.notes || '';
        
        // Work days
        const workDays = doctor.workDays || [];
        document.querySelectorAll('.doctor-day-checkbox-new').forEach(cb => {
            cb.checked = workDays.includes(cb.value);
        });
        
        // Hide password section when editing
        document.getElementById('passwordSection').style.display = 'none';
        
        await loadClinicsForDoctor();
        document.getElementById('doctorModalNew').classList.remove('hidden');
    } catch (error) {
        console.error('Error editing doctor:', error);
        alert('ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช');
    }
}

async function loadClinicsForDoctor() {
    const select = document.getElementById('doctorClinicNew');
    const clinicsSnap = await db.ref('clinics').once('value');
    const clinics = clinicsSnap.val() || {};
    
    select.innerHTML = '<option value="">ุงุฎุชุฑ ุงูุนูุงุฏุฉ</option>';
    Object.keys(clinics).forEach(id => {
        select.innerHTML += `<option value="${id}">${clinics[id].name}</option>`;
    });
}

async function saveDoctorNew() {
    const id = document.getElementById('editDoctorIdNew').value;
    const employeeNumber = document.getElementById('doctorEmployeeNumber').value;
    const name = document.getElementById('doctorNameNew').value;
    const phone = document.getElementById('doctorPhoneNew').value;
    const nationalId = document.getElementById('doctorNationalId').value;
    const specialty = document.getElementById('doctorSpecialtyNew').value;
    const clinicId = document.getElementById('doctorClinicNew').value;
    const workStatus = document.getElementById('doctorWorkStatus').value;
    const shift = document.getElementById('doctorShift').value;
    const regularLeave = parseInt(document.getElementById('doctorRegularLeave').value);
    const casualLeave = parseInt(document.getElementById('doctorCasualLeave').value);
    const email = document.getElementById('doctorEmail').value;
    const password = document.getElementById('doctorPassword').value;
    const notes = document.getElementById('doctorNotesNew').value;
    
    const workDays = Array.from(document.querySelectorAll('.doctor-day-checkbox-new:checked'))
        .map(cb => cb.value);

    if (!employeeNumber || !name || !phone || !specialty || !email) {
        alert('ูุฑุฌู ููุก ุงูุญููู ุงููุทููุจุฉ');
        return;
    }

    try {
        const doctorData = {
            employeeNumber,
            name,
            phone,
            nationalId,
            specialty,
            clinicId,
            workDays,
            workStatus,
            shift,
            regularLeaveBalance: regularLeave,
            casualLeaveBalance: casualLeave,
            absenceDays: 0,
            notes,
            email,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        if (id) {
            // Update existing
            await firestore.collection('doctors').doc(id).update(doctorData);
            alert('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงูุทุจูุจ');
        } else {
            // Create new
            if (!password) {
                alert('ูุฑุฌู ุฅุฏุฎุงู ูููุฉ ุงูุณุฑ');
                return;
            }

            // Create Firebase Auth user
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            
            doctorData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            await firestore.collection('doctors').add(doctorData);
            
            alert('ุชู ุฅุถุงูุฉ ุงูุทุจูุจ ุจูุฌุงุญ');
        }

        closeDoctorModalNew();
        loadDoctorsNew();
    } catch (error) {
        console.error('Error saving doctor:', error);
        if (error.code === 'auth/email-already-in-use') {
            alert('ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุชุฎุฏู ุจุงููุนู');
        } else {
            alert('ุฎุทุฃ ูู ุญูุธ ุงูุจูุงูุงุช: ' + error.message);
        }
    }
}

async function deleteDoctorNew(id) {
    if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุทุจูุจุ')) return;

    try {
        await firestore.collection('doctors').doc(id).delete();
        alert('ุชู ุญุฐู ุงูุทุจูุจ');
        loadDoctorsNew();
    } catch (error) {
        console.error('Error deleting doctor:', error);
        alert('ุฎุทุฃ ูู ุงูุญุฐู');
    }
}

function closeDoctorModalNew() {
    document.getElementById('doctorModalNew').classList.add('hidden');
}

// Attendance Management
async function saveAttendance() {
    const doctorId = document.getElementById('attendanceDoctor').value;
    const date = document.getElementById('attendanceDate').value;
    const checkIn = document.getElementById('checkInTime').value;
    const checkOut = document.getElementById('checkOutTime').value;
    const status = document.getElementById('attendanceStatus').value;
    const shift = document.getElementById('attendanceShift').value;
    const notes = document.getElementById('attendanceNotes').value;

    if (!doctorId || !date) {
        alert('ูุฑุฌู ุงุฎุชูุงุฑ ุงูุทุจูุจ ูุงูุชุงุฑูุฎ');
        return;
    }

    try {
        const month = date.substring(0, 7); // YYYY-MM
        
        const attendanceData = {
            doctorId,
            date,
            month,
            checkIn: checkIn ? firebase.firestore.Timestamp.fromDate(new Date(`${date}T${checkIn}`)) : null,
            checkOut: checkOut ? firebase.firestore.Timestamp.fromDate(new Date(`${date}T${checkOut}`)) : null,
            status,
            shift,
            notes,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        await firestore.collection('attendance').add(attendanceData);
        alert('ุชู ุญูุธ ุจูุงูุงุช ุงูุญุถูุฑ');
        
        // Clear form
        document.getElementById('attendanceDate').value = '';
        document.getElementById('checkInTime').value = '';
        document.getElementById('checkOutTime').value = '';
        document.getElementById('attendanceNotes').value = '';
    } catch (error) {
        console.error('Error saving attendance:', error);
        alert('ุฎุทุฃ ูู ุญูุธ ุงูุจูุงูุงุช');
    }
}

async function uploadAttendanceExcel() {
    const fileInput = document.getElementById('excelFile');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('ูุฑุฌู ุงุฎุชูุงุฑ ููู');
        return;
    }

    alert('ูุฐู ุงูููุฒุฉ ุชุชุทูุจ ููุชุจุฉ ููุฑุงุกุฉ Excel. ููููู ุงุณุชุฎุฏุงู SheetJS (xlsx) ูุชูููุฐูุง.');
    // Implementation would require xlsx library
}

// Requests Management
let currentAdminFilter = 'all';
let currentRequestId = null;

async function loadAdminRequests() {
    try {
        const requestsSnap = await firestore.collection('requests')
            .orderBy('submittedAt', 'desc')
            .get();

        const listDiv = document.getElementById('adminRequestsList');
        
        // Count by status
        let countAll = 0, countPending = 0, countApproved = 0, countRejected = 0;
        
        if (requestsSnap.empty) {
            listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">ูุง ุชูุฌุฏ ุทูุจุงุช</p>';
        } else {
            listDiv.innerHTML = '';
            requestsSnap.forEach(doc => {
                const req = { id: doc.id, ...doc.data() };
                countAll++;
                
                if (req.status === 'ููุฏ ุงููุฑุงุฌุนุฉ') countPending++;
                else if (req.status === 'ููุงูู') countApproved++;
                else if (req.status === 'ูุฑููุถ') countRejected++;
                
                // Filter
                if (currentAdminFilter !== 'all') {
                    const filterMap = { 'pending': 'ููุฏ ุงููุฑุงุฌุนุฉ', 'approved': 'ููุงูู', 'rejected': 'ูุฑููุถ' };
                    if (req.status !== filterMap[currentAdminFilter]) return;
                }
                
                const date = req.submittedAt ? new Date(req.submittedAt.toDate()).toLocaleDateString('ar-EG') : '';
                
                let statusBadge = '';
                if (req.status === 'ููุฏ ุงููุฑุงุฌุนุฉ') {
                    statusBadge = '<span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-bold">ููุฏ ุงููุฑุงุฌุนุฉ โณ</span>';
                } else if (req.status === 'ููุงูู') {
                    statusBadge = '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-bold">ููุงูู โ</span>';
                } else {
                    statusBadge = '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-bold">ูุฑููุถ โ</span>';
                }

                const actionBtn = req.status === 'ููุฏ ุงููุฑุงุฌุนุฉ' ? 
                    `<button onclick="openRequestReview('${req.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ูุฑุงุฌุนุฉ</button>` : 
                    `<button onclick="viewRequestDetails('${req.id}')" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">ุนุฑุถ</button>`;

                listDiv.innerHTML += `
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <div>
                                <h4 class="text-lg font-bold text-gray-800">${req.doctorName}</h4>
                                <p class="text-sm text-gray-600">${req.type}</p>
                            </div>
                            ${statusBadge}
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-600 mb-2">
                            <p><strong>ูู:</strong> ${req.fromDate}</p>
                            <p><strong>ุฅูู:</strong> ${req.toDate}</p>
                            <p><strong>ุงูุฃูุงู:</strong> ${req.days || 0}</p>
                            <p><strong>ุงููุงุฆู ุจุงูุนูู:</strong> ${req.replacement || '-'}</p>
                        </div>
                        ${req.notes ? `<p class="text-sm text-gray-600 mb-2"><strong>ููุงุญุธุงุช:</strong> ${req.notes}</p>` : ''}
                        <div class="flex items-center justify-between mt-3">
                            <p class="text-xs text-gray-500">ุชุงุฑูุฎ ุงูุชูุฏูู: ${date}</p>
                            ${actionBtn}
                        </div>
                    </div>
                `;
            });
        }

        // Update counts
        document.getElementById('countAll').textContent = countAll;
        document.getElementById('countPending').textContent = countPending;
        document.getElementById('countApproved').textContent = countApproved;
        document.getElementById('countRejected').textContent = countRejected;
    } catch (error) {
        console.error('Error loading requests:', error);
    }
}

function filterAdminRequests(filter) {
    currentAdminFilter = filter;
    
    // Update button styles
    document.querySelectorAll('.admin-filter-btn').forEach(btn => {
        btn.classList.remove('bg-blue-600', 'text-white', 'bg-gray-200');
        btn.classList.add('bg-gray-200');
    });
    event.target.classList.remove('bg-gray-200');
    event.target.classList.add('bg-blue-600', 'text-white');
    
    loadAdminRequests();
}

async function openRequestReview(id) {
    currentRequestId = id;
    
    try {
        const doc = await firestore.collection('requests').doc(id).get();
        const req = doc.data();
        
        const content = document.getElementById('requestReviewContent');
        content.innerHTML = `
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                <p><strong>ุงูุทุจูุจ:</strong> ${req.doctorName}</p>
                <p><strong>ููุน ุงูุทูุจ:</strong> ${req.type}</p>
                <p><strong>ูู:</strong> ${req.fromDate} <strong>ุฅูู:</strong> ${req.toDate}</p>
                <p><strong>ุนุฏุฏ ุงูุฃูุงู:</strong> ${req.days}</p>
                <p><strong>ุงููุงุฆู ุจุงูุนูู:</strong> ${req.replacement || '-'}</p>
                ${req.notes ? `<p><strong>ููุงุญุธุงุช ุงูุทุจูุจ:</strong> ${req.notes}</p>` : ''}
            </div>
        `;
        
        document.getElementById('adminResponseText').value = '';
        document.getElementById('requestReviewModal').classList.remove('hidden');
    } catch (error) {
        console.error('Error loading request:', error);
    }
}

async function reviewRequest(action) {
    const response = document.getElementById('adminResponseText').value;
    
    if (!confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ${action === 'approve' ? 'ุงูููุงููุฉ' : 'ุงูุฑูุถ'}ุ`)) return;

    try {
        const doc = await firestore.collection('requests').doc(currentRequestId).get();
        const req = doc.data();
        
        const updateData = {
            status: action === 'approve' ? 'ููุงูู' : 'ูุฑููุถ',
            adminResponse: response,
            reviewedAt: firebase.firestore.FieldValue.serverTimestamp(),
            reviewedBy: currentUser.email
        };
        
        await firestore.collection('requests').doc(currentRequestId).update(updateData);
        
        // If approved, deduct from leave balance
        if (action === 'approve') {
            const doctorDoc = await firestore.collection('doctors')
                .where('name', '==', req.doctorName)
                .get();
            
            if (!doctorDoc.empty) {
                const doctorId = doctorDoc.docs[0].id;
                const doctor = doctorDoc.docs[0].data();
                
                if (req.type === 'ุฅุฌุงุฒุฉ ุงุนุชูุงุฏูุฉ') {
                    await firestore.collection('doctors').doc(doctorId).update({
                        regularLeaveBalance: doctor.regularLeaveBalance - req.days
                    });
                } else if (req.type === 'ุฅุฌุงุฒุฉ ุนุงุฑุถุฉ') {
                    await firestore.collection('doctors').doc(doctorId).update({
                        casualLeaveBalance: doctor.casualLeaveBalance - req.days
                    });
                }
            }
        }
        
        alert('ุชู ูุฑุงุฌุนุฉ ุงูุทูุจ');
        closeRequestReviewModal();
        loadAdminRequests();
    } catch (error) {
        console.error('Error reviewing request:', error);
        alert('ุฎุทุฃ ูู ูุฑุงุฌุนุฉ ุงูุทูุจ');
    }
}

function closeRequestReviewModal() {
    document.getElementById('requestReviewModal').classList.add('hidden');
}

// Complaints Management
let currentComplaintFilter = 'all';
let currentComplaintId = null;

async function loadComplaints() {
    try {
        let query = firestore.collection('complaints').orderBy('submittedAt', 'desc');
        
        const complaintsSnap = await query.get();
        const listDiv = document.getElementById('complaintsList');
        
        let newCount = 0;
        
        if (complaintsSnap.empty) {
            listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">ูุง ุชูุฌุฏ ุดูุงูู ุฃู ุงูุชุฑุงุญุงุช</p>';
        } else {
            listDiv.innerHTML = '';
            complaintsSnap.forEach(doc => {
                const comp = { id: doc.id, ...doc.data() };
                
                if (comp.status === 'ุฌุฏูุฏ') newCount++;
                
                // Filter
                if (currentComplaintFilter === 'new' && comp.status !== 'ุฌุฏูุฏ') return;
                if (currentComplaintFilter === 'ุดููู' && comp.type !== 'ุดููู') return;
                if (currentComplaintFilter === 'ุงูุชุฑุงุญ' && comp.type !== 'ุงูุชุฑุงุญ') return;
                
                const date = comp.submittedAt ? new Date(comp.submittedAt.toDate()).toLocaleDateString('ar-EG') : '';
                
                const typeColor = comp.type === 'ุดููู' ? 'text-red-600' : 'text-blue-600';
                const statusBadge = comp.status === 'ุฌุฏูุฏ' ? 
                    '<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-bold">ุฌุฏูุฏ ๐ด</span>' :
                    comp.status === 'ููุฏ ุงููุฑุงุฌุนุฉ' ?
                    '<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs font-bold">ููุฏ ุงููุฑุงุฌุนุฉ</span>' :
                    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold">ุชู ุงูุฑุฏ โ</span>';

                listDiv.innerHTML += `
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <p class="${typeColor} font-bold">${comp.type}</p>
                            ${statusBadge}
                        </div>
                        <p class="text-gray-800 mb-2">${comp.content}</p>
                        <div class="grid grid-cols-3 gap-2 text-sm text-gray-600 mb-2">
                            ${comp.name ? `<p><strong>ุงูุงุณู:</strong> ${comp.name}</p>` : ''}
                            ${comp.phone ? `<p><strong>ุงููุงุชู:</strong> ${comp.phone}</p>` : ''}
                            ${comp.email ? `<p><strong>ุงูุจุฑูุฏ:</strong> ${comp.email}</p>` : ''}
                        </div>
                        ${comp.notes ? `<p class="text-sm text-gray-600 mb-2"><strong>ููุงุญุธุงุช:</strong> ${comp.notes}</p>` : ''}
                        ${comp.adminResponse ? `<div class="bg-blue-50 p-3 rounded mt-2"><p class="text-sm"><strong>ุฑุฏ ุงูุฅุฏุงุฑุฉ:</strong> ${comp.adminResponse}</p></div>` : ''}
                        <div class="flex items-center justify-between mt-3">
                            <p class="text-xs text-gray-500">${date}</p>
                            ${comp.status !== 'ุชู ุงูุฑุฏ' ? `<button onclick="openComplaintResponse('${comp.id}')" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">ุงูุฑุฏ</button>` : ''}
                        </div>
                    </div>
                `;
            });
        }
        
        document.getElementById('newComplaintsCount').textContent = newCount;
    } catch (error) {
        console.error('Error loading complaints:', error);
    }
}

function filterComplaints(filter) {
    currentComplaintFilter = filter;
    
    document.querySelectorAll('.complaint-filter-btn').forEach(btn => {
        btn.classList.remove('bg-blue-600', 'text-white', 'bg-gray-200');
        btn.classList.add('bg-gray-200');
    });
    event.target.classList.remove('bg-gray-200');
    event.target.classList.add('bg-blue-600', 'text-white');
    
    loadComplaints();
}

async function openComplaintResponse(id) {
    currentComplaintId = id;
    
    try {
        const doc = await firestore.collection('complaints').doc(id).get();
        const comp = doc.data();
        
        const content = document.getElementById('complaintContent');
        content.innerHTML = `
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                <p><strong>ุงูููุน:</strong> ${comp.type}</p>
                <p><strong>ุงููุญุชูู:</strong> ${comp.content}</p>
                ${comp.name ? `<p><strong>ุงูุงุณู:</strong> ${comp.name}</p>` : ''}
                ${comp.phone ? `<p><strong>ุงููุงุชู:</strong> ${comp.phone}</p>` : ''}
                ${comp.email ? `<p><strong>ุงูุจุฑูุฏ:</strong> ${comp.email}</p>` : ''}
            </div>
        `;
        
        document.getElementById('complaintResponseText').value = '';
        document.getElementById('complaintResponseModal').classList.remove('hidden');
        
        // Mark as under review
        await firestore.collection('complaints').doc(id).update({
            status: 'ููุฏ ุงููุฑุงุฌุนุฉ'
        });
    } catch (error) {
        console.error('Error opening complaint:', error);
    }
}

async function sendComplaintResponse() {
    const response = document.getElementById('complaintResponseText').value;
    
    if (!response.trim()) {
        alert('ูุฑุฌู ูุชุงุจุฉ ุงูุฑุฏ');
        return;
    }

    try {
        await firestore.collection('complaints').doc(currentComplaintId).update({
            adminResponse: response,
            status: 'ุชู ุงูุฑุฏ',
            respondedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert('ุชู ุฅุฑุณุงู ุงูุฑุฏ');
        closeComplaintResponseModal();
        loadComplaints();
    } catch (error) {
        console.error('Error sending response:', error);
        alert('ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฑุฏ');
    }
}

function closeComplaintResponseModal() {
    document.getElementById('complaintResponseModal').classList.add('hidden');
}

// Load data on page load (add to existing auth.onAuthStateChanged)
auth.onAuthStateChanged((user) => {
    if (user) {
        currentUser = user;
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        loadSettings();
        loadClinics();
        loadDoctorsNew(); // NEW
        loadAdminRequests(); // NEW
        loadComplaints(); // NEW
    } else {
        currentUser = null;
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('adminPanel').classList.add('hidden');
    }
});

// Initial date set
document.getElementById('attendanceDate').valueAsDate = new Date();



// ุฏุงูุฉ ุฅุฑุณุงู ุฃูุงูุฑ ุงูููุฏูู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
function videoControl(action) {
    db.ref('videoControl').push({
        action: action,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    });
    // ุนุฑุถ ุฑุณุงูุฉ ุตุบูุฑุฉ ููุชุฃููุฏ
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = 'ุชู โ๏ธ';
    setTimeout(() => btn.innerHTML = originalText, 1000);
}

// ุฏุงูุฉ ุงูุชุญูู ูู ุงูุตูุช
function setVideoVolume(value) {
    document.getElementById('videoVolumeDisplay').innerText = value + '%';
    db.ref('videoControl').push({
        action: 'volume',
        value: value,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    });
}

async function loadAppointments() {
    const tableBody = document.getElementById('appointmentsListTable');
    const dateFilter = document.getElementById('filterDate').value;
    const statusFilter = document.getElementById('filterStatusBooking').value;

    tableBody.innerHTML = '<tr><td colspan="7" class="text-center p-4">ุฌุงุฑู ุงูุชุญููู...</td></tr>';

    try {
        let query = firestore.collection('appointments');

        // ุชุทุจูู ุงูููุงุชุฑ
        if (dateFilter) {
            query = query.where('date', '==', dateFilter);
        } else {
            // ุงูุชุฑุงุถูุงู ูุนุฑุถ ุญุฌูุฒุงุช ุงูููู ุฅุฐุง ูู ูุชู ุงุฎุชูุงุฑ ุชุงุฑูุฎ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterDate').value = today;
            query = query.where('date', '==', today);
        }

        if (statusFilter) {
            query = query.where('status', '==', statusFilter);
        }

        const snapshot = await query.orderBy('time', 'asc').get();

        if (snapshot.empty) {
            tableBody.innerHTML = '<tr><td colspan="7" class="text-center p-4 text-gray-500">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ููุฐุง ุงูููู</td></tr>';
            return;
        }

        tableBody.innerHTML = '';
        snapshot.forEach(doc => {
            const data = doc.data();
            const id = doc.id;
            
            let statusColor = 'bg-blue-100 text-blue-800';
            if(data.status === 'ููุบู') statusColor = 'bg-red-100 text-red-800';
            if(data.status === 'ููุชูู') statusColor = 'bg-green-100 text-green-800';

            const row = `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-3 font-bold">${data.clientName}</td>
                    <td class="p-3">${data.clinicName}</td>
                    <td class="p-3">${data.date}</td>
                    <td class="p-3 dir-ltr text-right">${data.time}</td>
                    <td class="p-3">${data.phone}</td>
                    <td class="p-3"><span class="${statusColor} px-2 py-1 rounded text-xs font-bold">${data.status}</span></td>
                    <td class="p-3 flex gap-2">
                        <button onclick="updateAppointmentStatus('${id}', 'ููุชูู')" class="text-green-600 hover:text-green-800 text-sm font-bold">โ ุญุถุฑ</button>
                        <button onclick="updateAppointmentStatus('${id}', 'ููุบู')" class="text-red-600 hover:text-red-800 text-sm font-bold">โ ุฅูุบุงุก</button>
                        <button onclick="deleteAppointment('${id}')" class="text-gray-500 hover:text-gray-700">๐๏ธ</button>
                    </td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });

    } catch (error) {
        console.error("Error loading appointments: ", error);
        // ูู ุญุงู ุนุฏู ูุฌูุฏ Index ูู Firestore ูุฏ ูุญุฏุซ ุฎุทุฃุ ูุญุงูู ุจุฏูู ุชุฑุชูุจ
        if (error.code === 'failed-precondition') {
             alert('ูุฑุฌู ุฅูุดุงุก Index ูู Firestore Console ูุชุฑุชูุจ ุงููุชุงุฆุฌุ ุฃู ุณูุชู ุงูุนุฑุถ ุจุฏูู ุชุฑุชูุจ ุฒููู ุฏููู ูุคูุชุงู.');
        }
        tableBody.innerHTML = `<tr><td colspan="7" class="text-center p-4 text-red-500">ุญุฏุซ ุฎุทุฃ: ${error.message}</td></tr>`;
    }
}

async function updateAppointmentStatus(id, newStatus) {
    if(!confirm(`ูู ุชุฑูุฏ ุชุบููุฑ ุงูุญุงูุฉ ุฅูู ${newStatus}ุ`)) return;
    try {
        await firestore.collection('appointments').doc(id).update({
            status: newStatus
        });
        loadAppointments(); // ุฅุนุงุฏุฉ ุชุญููู ุงูุฌุฏูู
    } catch (error) {
        alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุญุฏูุซ');
    }
}

async function deleteAppointment(id) {
    if(!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูููุนุฏ ููุงุฆูุงูุ')) return;
    try {
        await firestore.collection('appointments').doc(id).delete();
        loadAppointments();
    } catch (error) {
        alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู');
    }
}

// ุชุญููู ุงูููุงุนูุฏ ุชููุงุฆูุงู ุนูุฏ ูุชุญ ุงูุตูุญุฉ
// ุฃุถู loadAppointments() ุฏุงุฎู ุฏุงูุฉ auth.onAuthStateChanged ุงูููุฌูุฏุฉ ูุณุจูุงู

        
    </script>
</body>
</html>
